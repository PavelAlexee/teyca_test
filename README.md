# Тестовое задание для ТЕЙКА

## Описание проекта
Реализация API для расчета и подтверждения операций покупки с учетом системы лояльности.

## Технологии
- Ruby
- Sinatra 
- Sequel 
- SQLite3 

## Установка
Клонируйте репозиторий:

```
git clone https://github.com/PavelAlexee/teyca_test.git
cd teyka-test
```
### Установите зависимости:

```bundle install```

Запустите приложение:

```rackup```

Приложение будет доступно по адресу: http://localhost:you_number

## Структура базы данных
База данных SQLite содержит 4 таблицы:

- Users - информация о клиентах
- Templates - уровни лояльности (Bronze, Silver, Gold)
- Products - товары с модификаторами лояльности
- Operations - история операций

## Дополнительные условия
Уровни лояльности
- Bronze - только кэшбек
- Silver - скидка и кэшбек
- Gold - только скидка

Модификаторы товаров:
- discount - дополнительная скидка

- increased_cashback - дополнительный кэшбек

- noloyalty - товар не участвует в программе лояльности
    
## API Endpoints

#### 1. Расчет операции

```
  POST /api/operation
```
Запрос:
- user_id - ID пользователя, совершающего покупку
- positions - массив товаров, в котором:
    - id - id товара
    - price - цена одной единицы товара
    - quantity - количество товара

Ответ:
- статус
- информация о пользователе
- id операции
- сумма(с учетом скидок)
- информация о бонусах:
    - баланс бонусов пользователя
    - доступно к списанию
    - общий процент кэшбека
    - будет начислено за покупку
- информация о скидках:
    - общая сумма скидки
    - общий процент скидки
- массив позиций, в котором каждая позиция имеет дополнительные поля:
    - тип
    - значение
    - описание
    - процент скидки
    - значение скидки

#### 2. Подтверждение операции

```
  POST /api/submit
```

Запрос:
- user - информацию о пользователе
- operation_id - id операции
- write_o - количество бонусов к списанию



Ответ:
- статус
- системное сообщение
- информация об операции:
    - id пользователя
    - количество бонусных баллов, заработанных за операцию(кэшбек)
    - общий процент кэшбека
    - общая скидка
    - общий процент скидки
    - количество списанных баллов
    - сумма к оплате

